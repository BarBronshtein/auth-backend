import{s as E,d as g,v as C,_ as y,o as d,c as p,g as t,x as n,y as a,w as b,p as w,j as U,m as $,f as m,k as h,a as f,z as k,A as O}from"./index.e3bfa579.js";const V=async e=>{const s="image-apps",r="https://api.cloudinary.com/v1_1/barry-apps/image/upload",l=new FormData;l.append("file",e),l.append("upload_preset",s);try{return(await E.post(r,l)).data}catch(u){throw console.log(u),new Error("Something went wrong please try again later")}},F=g({name:"edit-form",props:{user:{type:Object},originalEmail:{type:String}},data(){return{isOccupied:!1,userMsg:"",imgByUrl:!1}},methods:{addClass(e,s,i){e.classList.add(s),e.classList.remove(i)},async isEmailOccupied(){const e=this.$refs.email;if(!!this.user){if(this.user.email===this.originalEmail){this.addClass(e,"correct","incorrect");return}if(this.isOccupied=!0,e!=null&&e.checkValidity()){this.userMsg="Checking if email is occupied";const s=await C.getUserByEmail(this.user.email);this.isOccupied=!!s,this.isOccupied?(this.userMsg="This email is already occupied please try another email",this.addClass(e,"incorrect","correct")):(this.userMsg="",this.addClass(e,"correct","incorrect"))}}},handleFile(e){var r;const i=(r=e.currentTarget.files)==null?void 0:r[0];!i||this.isValidImage(i)&&this.uploadFile(i)},async uploadFile(e){if(!!this.user)try{const{url:s}=await V(e);this.user.photo=s,this.$forceUpdate()}catch(s){console.log(s)}},isValidImage(e){const s=/image-*/;return!!e.type.match(s)},validateForm(){const e=this.$refs.password,s=this.$refs.email,i=this.$refs.fullname;e!=null&&e.checkValidity()?this.addClass(e,"correct","incorrect"):this.addClass(e,"incorrect","correct"),(s==null?void 0:s.checkValidity())&&!this.isOccupied?this.addClass(s,"correct","incorrect"):this.addClass(s,"incorrect","correct"),i.value?this.addClass(i,"correct","incorrect"):this.addClass(i,"incorrect","correct")},formSubmit(){this.isOccupied||this.$emit("onUpdateUser",this.user)}},computed:{emailValidation(){return"[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$"},userImg(){return"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460__340.png"}}}),_=t("h2",null,"Change Info",-1),S=t("p",null,"Changes will be reflected every services",-1),B={class:"photo-input"},T={class:"img-container"},I=["src"],N=t("div",{class:"overlay"},null,-1),M={key:1,class:"input-group img-url"},D=t("label",null,"Image url",-1),L={class:"input-container"},A={class:"input-group"},z=t("label",null,"Name",-1),P={class:"input-group"},q=t("label",null,"Bio",-1),G={class:"input-group"},j=t("label",null,"Phone",-1),J={class:"input-group"},R=t("label",null,"Email",-1),H=["pattern"],K={class:"input-group"},Q=t("label",null,"Password",-1),W=t("button",{class:"action-btn"},"Save",-1);function X(e,s,i,r,l,u){return e.user?(d(),p("form",{key:0,class:"edit-form",onSubmit:s[12]||(s[12]=b((...o)=>e.formSubmit&&e.formSubmit(...o),["prevent"]))},[_,S,t("div",B,[t("div",T,[t("input",{class:"img-input",type:"file",accept:"image/*",onChange:s[0]||(s[0]=(...o)=>e.handleFile&&e.handleFile(...o))},null,32),t("img",{src:e.user.photo||e.userImg,alt:""},null,8,I),N]),e.imgByUrl?(d(),p("div",M,[D,t("div",L,[n(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=o=>e.user.photo=o),placeholder:"Enter your image url"},null,512),[[a,e.user.photo]]),t("button",{onClick:s[3]||(s[3]=o=>e.imgByUrl=!1),type:"button",class:"action-btn"},"Save")])])):(d(),p("span",{key:0,onClick:s[1]||(s[1]=o=>e.imgByUrl=!0)},"Change photo"))]),t("div",A,[z,n(t("input",{onBlur:s[4]||(s[4]=(...o)=>e.validateForm&&e.validateForm(...o)),ref:"fullname","onUpdate:modelValue":s[5]||(s[5]=o=>e.user.fullname=o),type:"text",placeholder:"Enter your name...",required:""},null,544),[[a,e.user.fullname]])]),t("div",P,[q,n(t("textarea",{name:"bio",class:"bio",cols:"30",rows:"10","onUpdate:modelValue":s[6]||(s[6]=o=>e.user.bio=o),placeholder:"Enter your bio..."},null,512),[[a,e.user.bio]])]),t("div",G,[j,n(t("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>e.user.phone=o),type:"tel",placeholder:"Enter your phone..."},null,512),[[a,e.user.phone]])]),t("div",J,[R,n(t("input",{onBlur:s[8]||(s[8]=o=>{e.validateForm(),e.isEmailOccupied()}),ref:"email","onUpdate:modelValue":s[9]||(s[9]=o=>e.user.email=o),type:"email",pattern:e.emailValidation,placeholder:"Enter your name...",required:"",autocomplete:"username"},null,40,H),[[a,e.user.email]])]),t("div",K,[Q,n(t("input",{onBlur:s[10]||(s[10]=(...o)=>e.validateForm&&e.validateForm(...o)),ref:"password",type:"password","onUpdate:modelValue":s[11]||(s[11]=o=>e.user.password=o),minlength:"6",placeholder:"Enter your password...",required:"",autocomplete:"current-password"},null,544),[[a,e.user.password]])]),W],32)):w("",!0)}const Y=y(F,[["render",X]]),Z=g({name:"personal-info-edit",components:{editForm:Y},data(){return{}},methods:{...U(m,["updateUser"]),async update(e){var s,i;await this.updateUser(e),(i=(s=this.$router)==null?void 0:s.push("/personal-info"))!=null||this.customEventEmit("onGoTo","/personal-info")},customEventEmit(e,s){window.dispatchEvent(new CustomEvent(e,{detail:s}))}},computed:{...$(m,["user"]),userToChange(){const e=this.user;return JSON.parse(JSON.stringify(e))}},created(){var e,s;this.user||(s=(e=this.$router)==null?void 0:e.push("/"))!=null||this.customEventEmit("onGoTo","/")},unmounted(){}}),x={class:"personal-info-edit"},ee=t("span",{class:"fa-solid fa-al"},null,-1);function se(e,s,i,r,l,u){var c;const o=h("router-link"),v=h("editForm");return d(),p("main",x,[f(o,{to:"/personal-info"},{default:k(()=>[t("div",{onClick:s[0]||(s[0]=te=>e.customEventEmit("onGoTo","/personal-info")),class:"go-back flex"},[ee,O(" Back ")])]),_:1}),f(v,{user:e.userToChange,originalEmail:(c=e.user)==null?void 0:c.email,onOnUpdateUser:e.update},null,8,["user","originalEmail","onOnUpdateUser"])])}const ie=y(Z,[["render",se]]);export{ie as default};
