import{s as C,d as g,v as b,_ as y,o as d,c as p,a as t,x as a,y as n,i as U,e as $,m as E,u as m,f as h,g as f,z as w,A as _}from"./index.3a22eb0a.js";const O=async e=>{const s="image-apps",i="https://api.cloudinary.com/v1_1/barry-apps/image/upload",l=new FormData;l.append("file",e),l.append("upload_preset",s);try{return(await C.post(i,l)).data}catch(u){throw console.log(u),new Error("Something went wrong please try again later")}},V=g({name:"edit-form",props:{user:{type:Object},originalEmail:{type:String}},data(){return{isOccupied:!1,userMsg:"",imgByUrl:!1}},methods:{addClass(e,s,r){e.classList.add(s),e.classList.remove(r)},async isEmailOccupied(){const e=this.$refs.email;if(!!this.user){if(this.user.email===this.originalEmail){this.addClass(e,"correct","incorrect");return}if(this.isOccupied=!0,e.checkValidity()){this.userMsg="Checking if email is occupied";const s=await b.getUserByEmail(this.user.email);this.isOccupied=!!s,this.isOccupied?(this.userMsg="This email is already occupied please try another email",this.addClass(e,"incorrect","correct")):(this.userMsg="",this.addClass(e,"correct","incorrect"))}}},handleFile(e){var i;const r=(i=e.currentTarget.files)==null?void 0:i[0];!r||this.isValidImage(r)&&this.uploadFile(r)},async uploadFile(e){if(!!this.user)try{const{url:s}=await O(e);this.user.photo=s}catch(s){console.log(s)}},isValidImage(e){const s=/image-*/;return!!e.type.match(s)},validateForm(){const e=this.$refs.password,s=this.$refs.email,r=this.$refs.fullname;e.checkValidity()?this.addClass(e,"correct","incorrect"):this.addClass(e,"incorrect","correct"),s.checkValidity()&&!this.isOccupied?this.addClass(s,"correct","incorrect"):this.addClass(s,"incorrect","correct"),r.value?this.addClass(r,"correct","incorrect"):this.addClass(r,"incorrect","correct")},formSubmit(){this.isOccupied||this.$emit("onUpdateUser",this.user)}},computed:{emailValidation(){return"[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$"},userImg(){if(!!this.user)return this.user.photo||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460__340.png"}}}),k=t("h2",null,"Change Info",-1),F=t("p",null,"Changes will be reflected every services",-1),S={class:"photo-input"},B={class:"img-container"},I=["src"],N=t("div",{class:"overlay"},null,-1),T={key:1,class:"input-group img-url"},D=t("label",null,"Image url",-1),L={class:"input-container"},M={class:"input-group"},A=t("label",null,"Name",-1),P={class:"input-group"},z=t("label",null,"Bio",-1),q={class:"input-group"},J=t("label",null,"Phone",-1),R={class:"input-group"},j=t("label",null,"Email",-1),G=["pattern"],H={class:"input-group"},K=t("label",null,"Password",-1),Q=t("button",{class:"action-btn"},"Save",-1);function W(e,s,r,i,l,u){return e.user?(d(),p("form",{key:0,class:"edit-form",onSubmit:s[12]||(s[12]=(...o)=>e.formSubmit&&e.formSubmit(...o))},[k,F,t("div",S,[t("div",B,[t("input",{class:"img-input",type:"file",accept:"image/*",onChange:s[0]||(s[0]=(...o)=>e.handleFile&&e.handleFile(...o))},null,32),t("img",{src:e.userImg,alt:""},null,8,I),N]),e.imgByUrl?(d(),p("div",T,[D,t("div",L,[a(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=o=>e.user.photo=o),placeholder:"Enter your image url"},null,512),[[n,e.user.photo]]),t("button",{onClick:s[3]||(s[3]=o=>e.imgByUrl=!1),type:"button",class:"action-btn"},"Save")])])):(d(),p("span",{key:0,onClick:s[1]||(s[1]=o=>e.imgByUrl=!0)},"Change photo"))]),t("div",M,[A,a(t("input",{onBlur:s[4]||(s[4]=(...o)=>e.validateForm&&e.validateForm(...o)),ref:"fullname","onUpdate:modelValue":s[5]||(s[5]=o=>e.user.fullname=o),type:"text",placeholder:"Enter your name...",required:""},null,544),[[n,e.user.fullname]])]),t("div",P,[z,a(t("textarea",{name:"bio",class:"bio",cols:"30",rows:"10","onUpdate:modelValue":s[6]||(s[6]=o=>e.user.bio=o),placeholder:"Enter your bio..."},null,512),[[n,e.user.bio]])]),t("div",q,[J,a(t("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>e.user.phone=o),type:"tel",placeholder:"Enter your phone..."},null,512),[[n,e.user.phone]])]),t("div",R,[j,a(t("input",{onBlur:s[8]||(s[8]=o=>{e.validateForm(),e.isEmailOccupied()}),ref:"email","onUpdate:modelValue":s[9]||(s[9]=o=>e.user.email=o),type:"email",pattern:e.emailValidation,placeholder:"Enter your name...",required:"",autocomplete:"username"},null,40,G),[[n,e.user.email]])]),t("div",H,[K,a(t("input",{onBlur:s[10]||(s[10]=(...o)=>e.validateForm&&e.validateForm(...o)),ref:"password",type:"password","onUpdate:modelValue":s[11]||(s[11]=o=>e.user.password=o),minlength:"6",placeholder:"Enter your password...",required:"",autocomplete:"current-password"},null,544),[[n,e.user.password]])]),Q],32)):U("",!0)}const X=y(V,[["render",W]]),Y=g({name:"personal-info-edit",components:{editForm:X},data(){return{}},methods:{...$(m,["updateUser"]),async update(e){await this.updateUser(e),this.$router.push("/personal-info")}},computed:{...E(m,["user"]),userToChange(){const e=this.user;return JSON.parse(JSON.stringify(e))}},created(){this.user||this.$router.push("/")},unmounted(){}}),Z={class:"personal-info-edit"},x=t("span",{class:"fa-solid fa-al"},null,-1);function ee(e,s,r,i,l,u){var c;const o=h("router-link"),v=h("editForm");return d(),p("main",Z,[f(o,{to:"/personal-info"},{default:w(()=>[x,_(" Back ")]),_:1}),f(v,{user:e.userToChange,originalEmail:(c=e.user)==null?void 0:c.email,onOnUpdateUser:e.update},null,8,["user","originalEmail","onOnUpdateUser"])])}const te=y(Y,[["render",ee]]);export{te as default};
